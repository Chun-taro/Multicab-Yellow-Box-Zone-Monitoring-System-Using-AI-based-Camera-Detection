{% extends "layout.html" %}

{% block content %}
<div class="header">
    <h1 class="page-title">Violation History</h1>
</div>

<div class="card">
    <div class="card-body">
        {% if violations %}
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Timestamp</th>
                        <th>Violation Type</th>
                        <th>Plate Number</th>
                        <th>Evidence</th>
                    </tr>
                </thead>
                <tbody>
                    {% for v in violations %}
                    <tr>
                        <td>#{{ v.id }}</td>
                        <td>{{ v.timestamp }}</td>
                        <td><span class="violation-tag">Yellow Box Entry</span></td>
                        <td>{{ v.plate_number if v.plate_number else 'Unreadable' }}</td>
                        <td>
                            {% if v.image_path %}
                            <button class="btn-view" onclick="openModal('{{ v.image_path }}')">View Image</button>
                            {% else %}
                            <span style="color: var(--text-muted);">No Image</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
            <p style="color: var(--text-muted); text-align: center;">No violations recorded in the database.</p>
        {% endif %}
    </div>
</div>

<!-- Image Modal -->
<div id="imageModal" class="modal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <h2 style="margin-bottom: 1rem;">Violation Evidence</h2>
        <img id="modalImage" class="modal-image" src="" alt="Violation Evidence">
    </div>
</div>

<script>
    function openModal(imagePath) {
        const modal = document.getElementById('imageModal');
        const modalImg = document.getElementById('modalImage');
        modalImg.src = '/static/' + imagePath;
        modal.style.display = "flex";
    }

    function closeModal() {
        document.getElementById('imageModal').style.display = "none";
    }

    window.onclick = function(event) {
        const modal = document.getElementById('imageModal');
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>
{% endblock %}